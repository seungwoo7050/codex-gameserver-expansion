# v1.1.0 보고서

## 스키마/트랜잭션 요약
- `infra/db/migrations/001_init.sql`로 `match_results`에 `UNIQUE(match_id)`를 두고, `rating_applies`에 `UNIQUE(match_id, user_id)`를 추가해 결과/레이팅 중복을 DB에서 차단한다.
- `ratings` 테이블은 `user_id` 기본키와 `rating` 내림차순 인덱스로 리더보드 조회 성능을 보장한다.
- `ResultService`는 `MariaDbClient`의 단일 트랜잭션 안에서 결과 저장 → 가드 입력 → 레이팅 갱신을 처리하며, 중복 finalize는 데이터 변경 없이 성공으로 반환한다.

## 재시도/차단 정책
- `MariaDbClient`가 데드락/락 대기 타임아웃/일시적 연결 단절을 최대 3회(지수 백오프+지터) 재시도한다.
- 재시도 불가 오류는 즉시 실패로 전파하여 호출자가 오류를 감지하도록 한다.

## 실행/테스트
- 빌드: `./scripts/build.sh`
- 단위 테스트: `./scripts/test-unit.sh` (성공)
- 통합 테스트(실DB): `./scripts/test-it.sh` (실패: 환경에 Docker 미설치)
- E2E 테스트: `./scripts/test-e2e.sh` (미실행, Docker 의존성 부족)
