# v0.8.0 성능 리포트

## 환경
- OS: Linux 6.12.13 (uname -a)
- CPU: Intel(R) Xeon(R) Platinum 8370C @ 2.80GHz, vCPU 3개
- 메모리: 17GiB (스왑 없음)
- 빌드: `cmake -S server -B build && cmake --build build`
- 실행: `LOGIN_RATE_LIMIT_MAX=100 ./build/server_app` (로그인 레이트리밋 완화)
- 클라이언트 의존성: `pip install httpx websockets`

## 하네스 시나리오
- 위치: `tools/perf/harness.py`
- 공통 실행 명령 예시:
  ```bash
  LOGIN_RATE_LIMIT_MAX=100 ./build/server_app &
  python tools/perf/harness.py --clients 40 --queue-timeout 5 --session-timeout 12 --http-timeout 5 --ws-connect-timeout 5
  ```
- 램프업: 기본 `--ramp-delay 0.05` 로 클라이언트마다 0.05초씩 순차 지연
- 워크플로우: 사용자 등록/로그인 → WS 핸드셰이크 → `/api/queue/join` → `session.input` 1회 → `session.ended` 수신

## 측정 결과 (동시 40 연결, 타임아웃 12초)
| 구분 | 성공/실패 | 가입/로그인 평균 | WS 핸드셰이크 평균 | 큐→시작 p50/p95 | 시작→종료 p50/p95 |
| --- | --- | --- | --- | --- | --- |
| 개선 전(vector 재색인) | 40 / 0 | 3.805s | 1.484s | 0.744s / 3.537s | 0.499s / 0.591s |
| 개선 후(list+iterator) | 40 / 0 | 3.438s | 1.391s | 0.592s / 3.555s | 0.503s / 0.644s |

## 해석 및 개선 효과
- 큐 자료구조를 `vector`+재색인에서 `list`+iterator 맵으로 교체하여 페어링/타임아웃 제거 시 O(n) 재배치를 제거했다.
- 동시 40개 연결 조건에서 큐→시작 구간 중앙값이 0.744s → 0.592s로 약 20% 감소하여 짧은 구간에서 페어링 처리 속도가 빨라졌다.
- WS 핸드셰이크 평균도 1.484s → 1.391s로 소폭 개선되어 초기 연결 병목이 줄어들었다.
- p95는 네트워크 변동성 영향으로 큰 차이는 없었으며, 로그인/WS 평균이 안정화된 상태에서 성공률 100% 유지됨을 확인했다.

## 재현 및 주의 사항
- 로그인 레이트리밋이 기본 5회/분이므로 부하 테스트 시 `LOGIN_RATE_LIMIT_MAX`를 충분히 높여야 한다.
- 하네스 기본 램프업(0.05초) 없이 동시 연결을 몰아치면 서버가 인증/핸드셰이크에서 일시적으로 끊을 수 있다.
- 모든 데이터는 메모리 기반이므로 장시간 테스트 후 상태를 초기화하려면 서버 프로세스를 재시작한다.
